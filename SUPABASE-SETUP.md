# Configuración de Supabase

## Paso 1: Crear proyecto en Supabase

1. Ve a [https://supabase.com](https://supabase.com)
2. Crea una cuenta o inicia sesión
3. Crea un nuevo proyecto
4. Anota:
   - **Project URL**: `https://xxxxx.supabase.co`
   - **Database Password**: La contraseña que configuraste
   - **Anon Key**: En Settings > API
   - **Service Role Key**: En Settings > API

## Paso 2: Obtener Connection String

1. Ve a Settings > Database
2. En "Connection string" selecciona "URI"
3. Copia la cadena de conexión
4. Formato: `postgresql://postgres:[PASSWORD]@db.[PROJECT-REF].supabase.co:5432/postgres`

## Paso 3: Configurar en appsettings.json

Edita `RuralTech App/src/RuralTech.API/appsettings.json`:

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=db.xxxxx.supabase.co;Port=5432;Database=postgres;Username=postgres;Password=TU_PASSWORD;SSL Mode=Require;Trust Server Certificate=true"
  },
  "Supabase": {
    "Url": "https://xxxxx.supabase.co",
    "AnonKey": "tu-anon-key",
    "ServiceRoleKey": "tu-service-role-key"
  }
}
```

## Paso 4: Ejecutar migraciones

```powershell
cd "RuralTech App\src\RuralTech.API"
dotnet ef database update
```

## Paso 5: Crear tablas en Supabase

Ejecuta este SQL en el SQL Editor de Supabase:

```sql
-- Tabla Users
CREATE TABLE IF NOT EXISTS "Users" (
    "Id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "Email" TEXT NOT NULL UNIQUE,
    "PasswordHash" TEXT NOT NULL,
    "FullName" TEXT,
    "Phone" TEXT,
    "Location" TEXT,
    "CreatedAt" TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

-- Tabla Animals
CREATE TABLE IF NOT EXISTS "Animals" (
    "Id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "Name" TEXT NOT NULL,
    "Breed" TEXT,
    "BirthDate" DATE,
    "Sex" TEXT,
    "CurrentWeight" DECIMAL(10,2),
    "LastVaccineDate" DATE,
    "UserId" INTEGER NOT NULL,
    "CreatedAt" TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT "FK_Animals_Users_UserId" FOREIGN KEY ("UserId") REFERENCES "Users"("Id") ON DELETE CASCADE
);

-- Tabla WeightRecords
CREATE TABLE IF NOT EXISTS "WeightRecords" (
    "Id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "AnimalId" INTEGER NOT NULL,
    "Weight" DECIMAL(10,2) NOT NULL,
    "Date" DATE NOT NULL,
    "CreatedAt" TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT "FK_WeightRecords_Animals_AnimalId" FOREIGN KEY ("AnimalId") REFERENCES "Animals"("Id") ON DELETE CASCADE
);

-- Tabla Vaccines
CREATE TABLE IF NOT EXISTS "Vaccines" (
    "Id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "AnimalId" INTEGER NOT NULL,
    "Name" TEXT NOT NULL,
    "DateApplied" DATE NOT NULL,
    "NextDueDate" DATE,
    "CreatedAt" TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT "FK_Vaccines_Animals_AnimalId" FOREIGN KEY ("AnimalId") REFERENCES "Animals"("Id") ON DELETE CASCADE
);

-- Tabla Treatments
CREATE TABLE IF NOT EXISTS "Treatments" (
    "Id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "AnimalId" INTEGER NOT NULL,
    "Name" TEXT NOT NULL,
    "DateApplied" DATE NOT NULL,
    "Notes" TEXT,
    "CreatedAt" TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT "FK_Treatments_Animals_AnimalId" FOREIGN KEY ("AnimalId") REFERENCES "Animals"("Id") ON DELETE CASCADE
);

-- Tabla Products
CREATE TABLE IF NOT EXISTS "Products" (
    "Id" INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "Name" TEXT NOT NULL,
    "Description" TEXT,
    "Price" DECIMAL(18,2) NOT NULL,
    "Category" TEXT,
    "SellerId" INTEGER NOT NULL,
    "Location" TEXT,
    "Phone" TEXT,
    "WhatsApp" TEXT,
    "Rating" DECIMAL(3,2),
    "ReviewCount" INTEGER DEFAULT 0,
    "IsFeatured" BOOLEAN DEFAULT FALSE,
    "IsActive" BOOLEAN DEFAULT TRUE,
    "CreatedAt" TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    CONSTRAINT "FK_Products_Users_SellerId" FOREIGN KEY ("SellerId") REFERENCES "Users"("Id") ON DELETE CASCADE
);

-- Índices para mejor rendimiento
CREATE INDEX IF NOT EXISTS "IX_Animals_UserId" ON "Animals"("UserId");
CREATE INDEX IF NOT EXISTS "IX_WeightRecords_AnimalId" ON "WeightRecords"("AnimalId");
CREATE INDEX IF NOT EXISTS "IX_Vaccines_AnimalId" ON "Vaccines"("AnimalId");
CREATE INDEX IF NOT EXISTS "IX_Treatments_AnimalId" ON "Treatments"("AnimalId");
CREATE INDEX IF NOT EXISTS "IX_Products_SellerId" ON "Products"("SellerId");
```

## Paso 6: Verificar conexión

Ejecuta el API y verifica que se conecte correctamente:

```powershell
cd "RuralTech App\src\RuralTech.API"
dotnet run
```

Si todo está bien, deberías ver que el API se inicia sin errores.
